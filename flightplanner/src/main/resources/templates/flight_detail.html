<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Lennu plaan</title>
    <style>
        /* Üldine lehe stiil */
        body {
          font-family: Arial, sans-serif;
          background: #f7f7f7;
          margin: 0;
          padding: 20px;
          color: #333;
        }
        .container {
          max-width: 900px;
          margin: auto;
          background: #fff;
          padding: 20px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
          position: relative;
        }
        h1, h2, h3 {
          margin-bottom: 20px;
        }
        .flight-info p {
          margin: 5px 0;
        }

        /*
          Istekohtade plaan – 6 veergu (A-F),
          grid-gap: 10px (veergudevahe),
          Istme laiuseks 30px,
          pseudoelemendi abil teeme laia vahekäigu. Vähemalt tahaks kasutada pseudoelementi selle tegemiseks, aga miskipärast see ei tööta ja ma ei saa aru miks
        */
        .seat-map {
          display: grid;
          grid-template-columns: repeat(6, 30px); /* 6 veergu, igaüks 30px lai */
          grid-gap: 10px;                         /* 10px vahe veergude ja ridade vahel */
          position: relative;
          margin-bottom: 20px;
          padding: 20px;                          /* Ruum pseudoelemendi jaoks */
          justify-content: center;                /* Paneme istmete joonduse keskele */
          z-index: 2;                             /* Istmed pseudoelemendist eespool */
        }
        .seat-map::before {
          content: "";
          position: absolute;
          top: 20px;
          bottom: 20px;
          /*
             Arvutus:
             - 3 veergu * 30px = 90px
             - 3 vahet * 10px = 30px
             - seat-map vasak padding 20px
             Kokku = 90 + 30 + 20 = 140px, sealt algab vahekäik (ideaalis)
          */
          left: calc((30px * 3) + (10px * 3) + 20px);
          width: 70px;                /* vahekäigu laius */
          background: #f7f7f7;        /* sama värv kui taust */
          pointer-events: none;       /* klikk ei mõjuta pseudoelemeni */
          z-index: 1;                 /* istmed (z-index:2) on sellest eespool */
        }

        /* Istme stiilid */
        .seat {
          background: #e0e0e0;
          border: 1px solid #ccc;
          padding: 5px;
          text-align: center;
          font-size: 12px;
          font-weight: bold;
          cursor: pointer;
          transition: background 0.3s;
        }
        .seat.available {
          background: #dff0d8; /* roheline – vaba */
        }
        .seat.taken {
          background: #f2dede; /* punane – hõivatud */
          cursor: not-allowed;
        }
        .seat.selected {
          background: #ffeeba; /* kollane – hetkel valitud */
        }

        /* Vormid ja nupud */
        .form-section {
          margin-top: 20px;
          padding: 15px;
          border: 1px solid #ccc;
          background: #fafafa;
        }
        button {
          background: #007bff;
          color: white;
          border: none;
          padding: 8px 16px;
          cursor: pointer;
          transition: background 0.3s;
        }
        button:hover {
          background: #0056b3;
        }

        /* Soovitatud istmete stiil */
        .result-list {
          list-style: none;
          padding: 0;
        }
        .result-list li {
          background: #f1f1f1;
          margin-bottom: 5px;
          padding: 10px;
          border: 1px solid #ddd;
        }
        a {
          text-decoration: none;
          color: #007bff;
        }
        a:hover {
          text-decoration: underline;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Lennu detailid</h1>

    <!-- Lennu põhiteave -->
    <div class="flight-info">
        <p><strong>ID:</strong> <span th:text="${flight.id}"></span></p>
        <p><strong>Sihtkoht:</strong> <span th:text="${flight.destination}"></span></p>
        <p><strong>Kuupäev:</strong> <span th:text="${flight.date}"></span></p>
        <p><strong>Lennu aeg:</strong> <span th:text="${flight.time}"></span></p>
        <p><strong>Hind:</strong> <span th:text="${T(java.lang.String).format('%.0f €', flight.price)}"></span></p>
    </div>

    <h2>Istekohad (Lennuki plaan)</h2>
    <div class="seat-map">
        <!-- seatMap: 6 veergu -> A-F. Kasutame pseudoelementi .seat-map::before, et tekitada lai vahe pärast 3. veergu -->
        <div th:each="seat : ${seatMap}"
             class="seat"
             th:text="${seat.seatId}"
             th:classappend="${seat.taken} ? ' taken' : ' available'">
            12A
        </div>
    </div>

    <!-- Nupp, millega kinnitatakse istmete valik -->
    <button id="confirmSelection">Kinnita valik</button>

    <!-- Vorm "Soovitatud istekohti": see eeldab, et POST-päring suunatakse meetodisse, mis kasutab seatService.recommendSeats(...) -->
    <div class="form-section">
        <h2>Soovitatud istekoht/kohad</h2>
        <!-- Vorm viib POST /flights/{id}/recommend -->
        <form th:action="@{'/flights/' + ${flight.id} + '/recommend'}" method="post">
            <div>
                <label>Istekohtade arv:
                    <input type="number" name="count" min="1" required style="width: 60px;"/>
                </label>
            </div>
            <div>
                <label><input type="checkbox" name="window" /> Soovin akna all olevat kohta</label>
            </div>
            <div>
                <label><input type="checkbox" name="extraLegroom" /> Soovin rohkem jalaruumi</label>
            </div>
            <div>
                <label><input type="checkbox" name="nearExit" /> Soovin olla lähemal väljapääsule</label>
            </div>
            <button type="submit">Otsi</button>
        </form>

        <div th:if="${recommendedSeats != null}">
            <div th:if="${#lists.isEmpty(recommendedSeats)}">
                <h3>Kahjuks sellist kohta ei ole saadaval.</h3>
            </div>
            <div th:if="${not #lists.isEmpty(recommendedSeats)}">
                <h3>Soovitatud istekoht/kohad:</h3>
                <ul class="result-list">
                    <li th:each="seat : ${recommendedSeats}" th:text="${seat.seatId}">12A</li>
                </ul>
            </div>
        </div>

    <p><a href="/flights">Tagasi lendude juurde</a></p>
</div>

<script>
    // JavaScripti osa, mis muudab klõpsatavad (available) istmed valitavaks
    document.addEventListener("DOMContentLoaded", function() {
        const seats = document.querySelectorAll('.seat.available');
        seats.forEach(function(seat) {
            seat.addEventListener('click', function() {
                seat.classList.toggle('selected');
            });
        });

        // "Kinnita valik" nupuu vajutamisel edasi juhtuv? Keeruline on eesti keeles õigeid sõnu valida programmeerimis terminite jaoks :)
        document.getElementById('confirmSelection').addEventListener('click', function() {
            const selectedSeats = document.querySelectorAll('.seat.selected');
            if(selectedSeats.length === 0) {
                alert("Palun vali vähemalt üks koht!");
                return;
            }
            let seatIds = [];
            selectedSeats.forEach(function(seat) {
                seatIds.push(seat.textContent.trim());
            });
            // Kuvab valitud kohad pop upina hetkel
            alert("Valitud istmed: " + seatIds.join(", "));
        });
    });
</script>
</body>
</html>
